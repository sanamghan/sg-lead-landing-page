<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sparrow Law - AI Google Ads Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; line-height: 1.6; color: #2d3748; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 30px; border-radius: 12px; text-align: center; margin-bottom: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .header h1 { font-size: 2.2em; font-weight: 700; margin-bottom: 8px; }
        .header .subtitle { font-size: 1.1em; opacity: 0.9; margin-bottom: 15px; }
        .header .timestamp { background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 0.9em; display: inline-block; }
        .executive-summary { background: #fed7aa; border: 3px solid #fdba74; border-radius: 12px; padding: 25px; margin-bottom: 30px; border-left: 6px solid #ea580c; }
        .executive-summary h2 { color: #9a3412; font-size: 1.4em; margin-bottom: 15px; }
        .executive-summary p { color: #7c2d12; font-size: 1.05em; line-height: 1.7; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: white; padding: 25px; border-radius: 12px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; position: relative; }
        .metric-card .period-label { position: absolute; top: 10px; right: 10px; background: #f1f5f9; color: #64748b; padding: 4px 8px; border-radius: 12px; font-size: 0.75em; font-weight: 600; }
        .metric-value { font-size: 2.2em; font-weight: 700; margin-bottom: 8px; color: #2563eb; }
        .metric-value.green { color: #16a34a; }
        .metric-value.orange { color: #ea580c; }
        .metric-label { color: #64748b; font-weight: 600; margin-bottom: 8px; }
        .metric-change { font-size: 0.85em; padding: 4px 8px; border-radius: 12px; font-weight: 600; background: #f1f5f9; color: #475569; }
        .section { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; }
        .section-header { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f1f5f9; }
        .section-header h2 { font-size: 1.5em; color: #1e293b; }
        .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; margin: 20px 0; }
        .data-table th { background: #f8fafc; padding: 15px; text-align: left; font-weight: 700; color: #374151; border-bottom: 2px solid #e5e7eb; }
        .data-table td { padding: 12px 15px; border-bottom: 1px solid #f3f4f6; }
        .data-table tr:hover { background: #f9fafb; }
        .status-badge { padding: 4px 12px; border-radius: 12px; font-size: 0.8em; font-weight: 600; text-transform: uppercase; }
        .status-warning { background: #fed7aa; color: #9a3412; }
        .status-success { background: #d1fae5; color: #065f46; }
        .refresh-button { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-weight: 600; cursor: pointer; margin-bottom: 20px; }
        .refresh-button:hover { opacity: 0.9; }
        .loading { color: #64748b; font-style: italic; }
        .error { color: #dc2626; background: #fee; padding: 10px; border-radius: 8px; margin: 10px 0; }
        .success { color: #16a34a; background: #f0fdf4; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #16a34a; }
        .real-time-indicator { position: fixed; top: 20px; right: 20px; background: #22c55e; color: white; padding: 10px 15px; border-radius: 20px; font-size: 0.85em; font-weight: 600; box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3); z-index: 1000; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body>
    <div class="real-time-indicator">ü§ñ Live Data Connected</div>

    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Google Ads Dashboard</h1>
            <div class="subtitle">Sparrow Law Group - 7-Day Performance Analysis</div>
            <div class="timestamp" id="currentTime">üìÖ Loading...</div>
        </div>

        <button class="refresh-button" onclick="loadAllData()">üîÑ Refresh Data</button>

        <div class="executive-summary">
            <h2>üéØ 7-Day Executive Summary</h2>
            <p id="summary" class="loading">Loading real data from Google Sheets...</p>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="period-label">7 Days</div>
                <div class="metric-value" id="totalSpend">$0.00</div>
                <div class="metric-label">Total Spend</div>
                <div class="metric-change">üìä From Google Ads</div>
            </div>
            <div class="metric-card">
                <div class="period-label">7 Days</div>
                <div class="metric-value green" id="totalConversions">0</div>
                <div class="metric-label">Total Conversions</div>
                <div class="metric-change">üìä Live Data</div>
            </div>
            <div class="metric-card">
                <div class="period-label">7 Days</div>
                <div class="metric-value green" id="avgCPA">$0.00</div>
                <div class="metric-label">Average CPA</div>
                <div class="metric-change">üìä Real-time</div>
            </div>
            <div class="metric-card">
                <div class="period-label">7 Days</div>
                <div class="metric-value orange" id="conversionRate">0.00%</div>
                <div class="metric-label">Conversion Rate</div>
                <div class="metric-change">üìä Tracking</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2>üìä Campaign Performance Overview</h2>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>7-Day Total</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="campaignTable">
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 20px;" class="loading">Loading campaign data...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-header">
                <h2>üéØ Ad Group Performance</h2>
                <p style="font-size: 0.9em; color: #64748b; margin-top: 5px;">Showing only ad groups with spend data</p>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Campaign</th>
                        <th>Ad Group</th>
                        <th>Status</th>
                        <th>Spend</th>
                        <th>Conversions</th>
                        <th>Performance</th>
                    </tr>
                </thead>
                <tbody id="adGroupTable">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;" class="loading">Loading ad group data...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-header">
                <h2>üîç Search Terms Analysis</h2>
                <p style="font-size: 0.9em; color: #64748b; margin-top: 5px;">Search terms with cost but no conversions</p>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Search Term</th>
                        <th>Cost</th>
                        <th>Clicks</th>
                        <th>Conversions</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="searchTermsTable">
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;" class="loading">Loading search terms...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const SHEET_ID = '1YU8dpDXYzMip8dMRPSMJIwxoN63RsOc4kCQC3gwMMWY';
        const API_KEY = 'AIzaSyAkot5fE5EkTfB_EMwneh_UkJ0180K97_A';

        let dashboardData = {
            summary: {},
            adGroups: [],
            searchTerms: [],
            loadTime: null
        };

        async function loadAllData() {
            console.log('üöÄ Starting data load...');
            updateTimestamp();
            
            try {
                await loadSummaryData();
                await loadAdGroupData();
                await loadSearchTermsData();
                updateDashboard();
                showMessage('‚úÖ Data loaded successfully!', 'success');
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                showMessage('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function loadSummaryData() {
            console.log('üìä Loading summary data...');
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Live_Summary!A:B?key=${API_KEY}`;
            
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Summary API error: ${response.status}`);
            
            const result = await response.json();
            if (result.error) throw new Error(result.error.message);
            
            if (result.values && result.values.length > 1) {
                dashboardData.summary = {};
                
                result.values.slice(1).forEach(row => {
                    if (row[0] && row[1]) {
                        const key = row[0].toLowerCase().trim();
                        const value = row[1];
                        
                        if (key.includes('spend') || key.includes('cost')) {
                            dashboardData.summary.spend = parseFloat(value.replace(/[$,]/g, '')) || 0;
                        } else if (key.includes('conversion')) {
                            dashboardData.summary.conversions = parseInt(value) || 0;
                        } else if (key.includes('click')) {
                            dashboardData.summary.clicks = parseInt(value.replace(/,/g, '')) || 0;
                        } else if (key.includes('impression')) {
                            dashboardData.summary.impressions = parseInt(value.replace(/,/g, '')) || 0;
                        }
                    }
                });
                
                console.log('‚úÖ Summary data loaded:', dashboardData.summary);
            }
        }

        async function loadAdGroupData() {
            console.log('üéØ Loading ad group data...');
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/AdGroup_Performance!A:K?key=${API_KEY}`;
            
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Ad Groups API error: ${response.status}`);
            
            const result = await response.json();
            if (result.error) throw new Error(result.error.message);
            
            if (result.values && result.values.length > 1) {
                dashboardData.adGroups = result.values.slice(1)
                    .map(row => ({
                        campaign: row[0] || '',
                        name: row[1] || '',
                        status: row[2] || '',
                        spend: parseFloat((row[6] || '0').replace(/[$,]/g, '')) || 0,
                        conversions: parseInt(row[4]) || 0,
                        performance: row[8] || 'Unknown'
                    }))
                    .filter(ag => ag.campaign && ag.name && ag.spend > 0);
                
                console.log('‚úÖ Ad groups loaded:', dashboardData.adGroups.length);
            }
        }

        async function loadSearchTermsData() {
            console.log('üîç Loading search terms data...');
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Search_Terms!A:F?key=${API_KEY}`;
            
            const response = await fetch(url);
            if (!response.ok) {
                console.log('‚ö†Ô∏è Search terms sheet not found, skipping...');
                return;
            }
            
            const result = await response.json();
            if (result.error) {
                console.log('‚ö†Ô∏è Search terms error:', result.error.message);
                return;
            }
            
            if (result.values && result.values.length > 1) {
                dashboardData.searchTerms = result.values.slice(1)
                    .map(row => ({
                        term: row[0] || '',
                        cost: parseFloat((row[1] || '0').replace(/[$,]/g, '')) || 0,
                        conversions: parseInt(row[2]) || 0,
                        clicks: parseInt(row[3]) || 0
                    }))
                    .filter(term => term.term && term.cost > 0 && term.conversions === 0)
                    .slice(0, 10);
                
                console.log('‚úÖ Search terms loaded:', dashboardData.searchTerms.length);
            }
        }

        function updateDashboard() {
            updateMetrics();
            updateCampaignTable();
            updateAdGroupTable();
            updateSearchTermsTable();
        }

        function updateMetrics() {
            const { spend = 0, conversions = 0, clicks = 0 } = dashboardData.summary;
            const cpa = conversions > 0 ? spend / conversions : 0;
            const convRate = clicks > 0 ? (conversions / clicks) * 100 : 0;

            document.getElementById('totalSpend').textContent = '$' + spend.toLocaleString('en-US', {minimumFractionDigits: 2});
            document.getElementById('totalConversions').textContent = conversions.toLocaleString();
            document.getElementById('avgCPA').textContent = '$' + cpa.toFixed(2);
            document.getElementById('conversionRate').textContent = convRate.toFixed(2) + '%';

            document.getElementById('summary').innerHTML = 
                `7-day performance: <strong>$${spend.toLocaleString('en-US', {minimumFractionDigits: 2})}</strong> spend with <strong>${conversions}</strong> conversions at <strong>$${cpa.toFixed(2)}</strong> CPA and <strong>${convRate.toFixed(2)}%</strong> conversion rate. <br><small style="color: #16a34a;"><strong>‚úÖ Live data updated: ${new Date().toLocaleTimeString()}</strong></small>`;
        }

        function updateCampaignTable() {
            const tbody = document.getElementById('campaignTable');
            const { spend = 0, conversions = 0, clicks = 0, impressions = 0 } = dashboardData.summary;
            
            tbody.innerHTML = `
                <tr><td>Total Spend</td><td>$${spend.toLocaleString('en-US', {minimumFractionDigits: 2})}</td><td><span class="status-badge ${spend > 0 ? 'status-success' : 'status-warning'}">${spend > 0 ? 'Active' : 'Inactive'}</span></td></tr>
                <tr><td>Total Conversions</td><td>${conversions.toLocaleString()}</td><td><span class="status-badge ${conversions > 0 ? 'status-success' : 'status-warning'}">${conversions > 0 ? 'Converting' : 'No Conversions'}</span></td></tr>
                <tr><td>Total Clicks</td><td>${clicks.toLocaleString()}</td><td><span class="status-badge status-success">Tracking</span></td></tr>
                <tr><td>Total Impressions</td><td>${impressions.toLocaleString()}</td><td><span class="status-badge status-success">Visibility</span></td></tr>
            `;
        }

        function updateAdGroupTable() {
            const tbody = document.getElementById('adGroupTable');
            
            if (dashboardData.adGroups.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">No ad groups with spend found</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            dashboardData.adGroups.forEach(ag => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${ag.campaign}</td>
                    <td>${ag.name}</td>
                    <td><span class="status-badge ${ag.status.toLowerCase().includes('enabled') ? 'status-success' : 'status-warning'}">${ag.status}</span></td>
                    <td>$${ag.spend.toFixed(2)}</td>
                    <td>${ag.conversions}</td>
                    <td>${ag.performance}</td>
                `;
            });
        }

        function updateSearchTermsTable() {
            const tbody = document.getElementById('searchTermsTable');
            
            if (dashboardData.searchTerms.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">No waste search terms found</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            dashboardData.searchTerms.forEach(term => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${term.term}</td>
                    <td>$${term.cost.toFixed(2)}</td>
                    <td>${term.clicks}</td>
                    <td>${term.conversions}</td>
                    <td><span class="status-badge status-warning">Add Negative</span></td>
                `;
            });
        }

        function updateTimestamp() {
            document.getElementById('currentTime').textContent = 'üìÖ ' + new Date().toLocaleString();
        }

        function showMessage(message, type) {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            document.querySelector('.container').insertBefore(div, document.querySelector('.executive-summary'));
            
            setTimeout(() => {
                if (div.parentNode) div.parentNode.removeChild(div);
            }, 5000);
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadAllData);

        // Auto-refresh every 5 minutes
        setInterval(loadAllData, 5 * 60 * 1000);
    </script>
</body>
</html>
